# A. å…¨éƒ¨é¡µé¢ä¸€è§ˆï¼ˆæŒ‰çŠ¶æ€å®Œæ•´è¦†ç›–ï¼‰

> è®¾å¤‡ï¼š**2.33-inch æ¨ªå± 222Ã—480**
> çº¦æŸï¼š**å›ºå®š TopBarï¼ˆBack / Title / Batteryï¼‰**

---

## A0. å…¨å±€ UI éª¨æ¶ï¼ˆå¤ç”¨ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ < Back          [ TITLE / CONTEXT ]        ğŸ”‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚                CONTENT AREA                  â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   [ Action 1 ]        [ Action 2 ]            â”‚  (å¯é€‰)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## A1. Team çŠ¶æ€å…¥å£é¡µï¼ˆæœªåŠ å…¥ï¼‰

**Titleï¼š`Team`**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ < Back                 Team               ğŸ”‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚        You are not in a team                  â”‚
â”‚                                              â”‚
â”‚   â€¢ No shared map                             â”‚
â”‚   â€¢ No team awareness                        â”‚
â”‚                                              â”‚
â”‚   Create or join a team                      â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ Create Team ]      [ Join Team ]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## A2. Team çŠ¶æ€å…¥å£é¡µï¼ˆå·²åŠ å…¥ï¼‰

**Titleï¼š`Team Status`**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ < Back            Team Status             ğŸ”‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Team: ALPHA-7                                â”‚
â”‚  Role:        Member                          â”‚
â”‚  Members:     5                               â”‚
â”‚  Online:      3                               â”‚
â”‚  Security:    OK   (Round 5)                  â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Team Health                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â— Leader online                              â”‚
â”‚  â— Last update 18s ago                        â”‚
â”‚  â—‹ 1 member stale                             â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ View Team ]     [ Invite ]     [ Leave ]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> è¿™æ˜¯ **åˆ¤æ–­â€œé˜Ÿä¼æ˜¯å¦è¿˜å¯ä¿¡â€** çš„é¡µé¢
> ä¸æ˜¯ç®¡ç†é¡µ

---

## A3. Team Homeï¼ˆæˆå‘˜ä¸ç»“æ„ï¼ŒLeader/Member é€šç”¨ï¼‰

**Titleï¼š`Team Â· Leader` æˆ– `Team Â· Member`**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ < Back          Team Â· Leader              ğŸ”‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Team: ALPHA-7                                â”‚
â”‚  Members: 3      Online: 2                   â”‚
â”‚  Security Round: 5                            â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Members                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â— You (Leader)        Online                â”‚
â”‚  â— Tom                 Online                â”‚
â”‚  â—‹ Jerry               Last seen 2m ago      â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ Invite ]        [ Manage ]     [ Leave ]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## A4. Invite é¡µé¢ï¼ˆLeaderï¼‰

**Titleï¼š`Invite`**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ < Back               Invite               ğŸ”‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Invite Code                                â”‚
â”‚                                              â”‚
â”‚        J4K â€“ 9Q2                              â”‚
â”‚                                              â”‚
â”‚   Expires in: 08:45                           â”‚
â”‚                                              â”‚
â”‚   Nearby devices can join                    â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ Refresh Code ]      [ Stop Invite ]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## A5. Join Teamï¼ˆæ‰«æ / è¾“å…¥é‚€è¯·ç ï¼‰

**Titleï¼š`Join Team`**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ < Back               Join Team            ğŸ”‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Nearby Teams                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ALPHA-7          Signal: â–®â–®â–®â–¯               â”‚
â”‚  BETA-3           Signal: â–®â–®â–¯â–¯               â”‚
â”‚                                              â”‚
â”‚  Or enter invite code                        â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ Enter Code ]        [ Refresh ]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## A6. Join Pendingï¼ˆç­‰å¾…æ‰¹å‡†ï¼‰

**Titleï¼š`Join Request`**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ < Back           Join Request             ğŸ”‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚   Request sent to ALPHA-7                    â”‚
â”‚                                              â”‚
â”‚   Waiting for approval...                    â”‚
â”‚                                              â”‚
â”‚   This may take a moment                     â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ Cancel ]            [ Retry ]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## A7. Members ç®¡ç†é¡µï¼ˆLeaderï¼‰

**Titleï¼š`Members`**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ < Back             Members               ğŸ”‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â— You (Leader)                              â”‚
â”‚                                              â”‚
â”‚  â— Tom                                      â”‚
â”‚     > Select                                 â”‚
â”‚                                              â”‚
â”‚  â—‹ Jerry                                    â”‚
â”‚     > Select                                 â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## A8. Member Detailï¼ˆLeaderï¼‰

**Titleï¼š`Member: Jerry`**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ < Back          Member: Jerry             ğŸ”‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Status:   Last seen 2m ago                  â”‚
â”‚  Role:     Member                            â”‚
â”‚                                              â”‚
â”‚  Device:   Pager                             â”‚
â”‚                                              â”‚
â”‚  Capability:                                â”‚
â”‚   â€¢ Position                                 â”‚
â”‚   â€¢ Waypoint                                 â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ Kick ]        [ Transfer Leader ]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## A9. Kick ç¡®è®¤é¡µï¼ˆå®‰å…¨å…³é”®ï¼‰

**Titleï¼š`Kick Member`**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ < Back             Kick Member            ğŸ”‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Remove Jerry from team?                     â”‚
â”‚                                              â”‚
â”‚  This will update the security round.        â”‚
â”‚  Jerry will no longer receive                â”‚
â”‚  team messages or waypoints.                 â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ Cancel ]              [ Confirm Kick ]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## A10. è¢«è¸¢ / å¤±æ•ˆçŠ¶æ€é¡µï¼ˆMemberï¼‰

**Titleï¼š`Team`**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ < Back               Team                ğŸ”‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  You are no longer in this team               â”‚
â”‚                                              â”‚
â”‚  Access to team data revoked                  â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ Join Another Team ]     [ OK ]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# B. é¡µé¢æµè½¬è¯´æ˜ï¼ˆUI çŠ¶æ€æœºï¼‰

## B1. é¡¶å±‚æµè½¬ï¼ˆç®€åŒ–ï¼‰

```
[ Team Menu ]
     |
     v
[ Team Status ]
     |
     +--> (not in team) --> [ Create Team ] -> [ Team Status (joined) ]
     |
     +--> (joined) -------> [ View Team ] -> [ Team Home ]
```

---

## B2. åŠ å…¥æµç¨‹ï¼ˆMemberï¼‰

```
[ Team Status (not in team) ]
        |
        v
    [ Join Team ]
        |
        v
 [ Join Pending ]
        |
        +-- reject/timeout --> [ Join Team ]
        |
        +-- accept ----------> [ Team Status (joined) ]
```

---

## B3. é‚€è¯·æµç¨‹ï¼ˆLeaderï¼‰

```
[ Team Home ]
     |
     v
  [ Invite ]
     |
     +-- member joins --> [ Join Request popup ]
                              |
                              +-- accept --> epoch rotate
                              |               |
                              |               v
                              |        [ Team Status ]
                              |
                              +-- reject
```

---

## B4. è¸¢äººæµç¨‹ï¼ˆLeaderï¼‰

```
[ Team Home ]
     |
     v
[ Members ]
     |
     v
[ Member Detail ]
     |
     v
[ Kick Confirm ]
     |
     +-- confirm --> epoch rotate --> [ Team Status ]
```

---

# C. æ¶‰åŠçš„åè®®ï¼ˆPager Team Core v0.1ï¼‰

## C1. åè®®æ¶ˆæ¯ç±»å‹ï¼ˆæœ€å°é›†ï¼‰

| ç±»å‹                   | ç”¨é€”      |
| -------------------- | ------- |
| `TEAM_INVITE`        | å¹¿æ’­é‚€è¯·ç    |
| `TEAM_JOIN_REQ`      | ç”³è¯·åŠ å…¥    |
| `TEAM_JOIN_DECISION` | åŒæ„ / æ‹’ç» |
| `TEAM_KICK`          | è¸¢äººäº‹ä»¶    |
| `TEAM_EPOCH_ROTATE`  | å®£å‘Šè½®æ¬¡æ›´æ–°  |
| `TEAM_KEY_DIST`      | æ–°å¯†é’¥åˆ†å‘   |
| `TEAM_PRESENCE`      | åœ¨çº¿çŠ¶æ€    |
| `TEAM_POS`           | ä½ç½®      |
| `TEAM_SYNC_REQ`      | è¡¥é½è¯·æ±‚    |
| `TEAM_SYNC_RSP`      | è¡¥é½å“åº”    |

---

## C2. TeamEnvelopeï¼ˆæ‰€æœ‰ Team åŒ…ç»Ÿä¸€å¤–å£³ï¼‰

```
TeamEnvelope {
  team_id
  epoch
  type
  sender_id
  seq
  timestamp
  auth
  payload
}
```

---

# D. åè®®æµè½¬ï¼ˆå’Œ UI çš„å¯¹åº”å…³ç³»ï¼‰

## D1. Create Team

* æœ¬åœ°ç”Ÿæˆ `team_id`
* `epoch = 1`
* è‡ªå·± = leader
* ç”Ÿæˆ `team_key(1)`

---

## D2. Invite / Join

**Invite**

* Leader å‘¨æœŸå‘ `TEAM_INVITE`

**Join**

1. Member â†’ `TEAM_JOIN_REQ`
2. Leader â†’ `TEAM_JOIN_DECISION(ACCEPT)`
3. Leader â†’ `epoch++`
4. Leader â†’ `TEAM_KEY_DIST(epoch)`
5. åŒæ–¹è¿›å…¥æ–° epoch

---

## D3. Kick

1. Leader â†’ `TEAM_KICK(target)`
2. Leader â†’ `epoch++`
3. Leader â†’ `TEAM_KEY_DIST(epoch)`
4. è¢«è¸¢æˆå‘˜è§£å¯†å¤±è´¥ â†’ UI åˆ‡åˆ° A10

---

## D4. Presence & Health

* æ‰€æœ‰æˆå‘˜å‘¨æœŸå‘ `TEAM_PRESENCE`
* Status é¡µå­—æ®µæ¥è‡ªï¼š

  * last_seen_ts
  * leader presence
  * epoch ä¸€è‡´æ€§

---

## D5. Syncï¼ˆè¡¥é½ï¼‰

1. å‘ç° `event_seq` è½å
2. â†’ `TEAM_SYNC_REQ(from_seq)`
3. â†’ `TEAM_SYNC_RSP(events...)`
4. é‡æ”¾äº‹ä»¶ï¼ŒUI åˆ·æ–°

---

ä¸‹é¢æˆ‘æŠŠå‰é¢é‚£å¥— **Pager Team Core v0.1ï¼ˆå…¥é˜Ÿ/è¸¢äºº/è§’è‰² + çŠ¶æ€é¡µæµè½¬ + åè®®æµè½¬ï¼‰**ï¼Œç›´æ¥â€œè½â€åˆ°ä½ å·¥ç¨‹é‡Œï¼š**æ¨¡å—æ¸…å•ï¼ˆæŒ‰ä½  domain/usecase/ports/infra/ui çš„é£æ ¼ï¼‰+ çŠ¶æ€æœºä¼ªä»£ç **ã€‚æˆ‘ä¼šå°½é‡è´´è¿‘ä½  Trail Mate çš„æ¶æ„ä¹ æƒ¯ï¼ˆçº¯ domainã€usecase ç¼–æ’ã€ports æŠ½è±¡ã€infra é€‚é… Meshtasticã€UI ç‹¬ç«‹çŠ¶æ€ï¼‰ã€‚

---

# 1) æ¨¡å—æ¸…å•ï¼ˆå·¥ç¨‹å†…ç›®å½•ä¸èŒè´£ï¼‰

## 1.1 å»ºè®®ç›®å½•ç»“æ„

```
src/team/
  domain/
    team_types.h
    team_model.h/.cpp
    team_events.h
    team_policy.h
    team_crypto.h
    team_codec.h         // Envelope ç¼–è§£ç ï¼ˆçº¯å‡½æ•°ï¼‰

  usecase/
    team_service.h/.cpp  // å…¥å£ç¼–æ’ï¼šUIåŠ¨ä½œ + RadioåŒ… + å­˜å‚¨
    team_join_flow.h/.cpp
    team_admin_flow.h/.cpp
    team_sync_flow.h/.cpp
    team_presence_flow.h/.cpp

  ports/
    i_team_store.h       // æŒä¹…åŒ–ï¼šsnapshot + event log
    i_team_transport.h   // å‘é€/æ¥æ”¶ Team åŒ…ï¼ˆåŸºäº Meshtastic portnumï¼‰
    i_team_crypto.h      // ç”Ÿæˆ/æ´¾ç”Ÿ/åŠ è§£å¯†/MACï¼ˆå¯åœ¨ domain é‡Œåšï¼Œä½†å»ºè®® portï¼‰
    i_clock.h            // æ—¶é—´æˆ³ï¼ˆå¯å¤ç”¨ç³»ç»Ÿå·²æœ‰ï¼‰
    i_rng.h              // éšæœºæ•°ï¼ˆteam_id / keyï¼‰
    i_ui_notifier.h      // å¼¹çª—/Toast/é¡µé¢è·³è½¬äº‹ä»¶ï¼ˆå¯é€‰ï¼‰

  infra/
    meshtastic/
      mt_team_transport.h/.cpp   // ç»‘å®š IMeshAdapter / portnum
    store/
      team_store_flash.h/.cpp    // Preferences/Flash
      team_store_sd.h/.cpp       // å¯é€‰ï¼šSD eventlog
    crypto/
      team_crypto_impl.h/.cpp    // AES/ChaCha + HMAC ç­‰

  ui/
    screens/team/
      team_state.h/.cpp          // UI stateï¼šå½“å‰é¡µã€åˆ—è¡¨æ•°æ®ã€loading/err
      team_pages.h/.cpp          // enter/exit, render
      team_input.h/.cpp          // æŒ‰é”®/æ—‹é’®æ˜ å°„ä¸º action
      team_components.h/.cpp     // list item, modal, bottom actions
      team_nav.h/.cpp            // ç®€å•å¯¼èˆªï¼ˆStatus/Home/Invite/Join...ï¼‰
```

> ä½ å¦‚æœå·²ç»æœ‰ â€œscreens/xxx/ layout/components/input/stateâ€ çš„èŒƒå¼ï¼Œå°±å®Œå…¨æŒ‰é‚£å¥—å¥—è¿›å»ã€‚

---

## 1.2 å…³é”®èŒè´£è¾¹ç•Œ

### Domainï¼ˆçº¯é€»è¾‘ï¼‰

* **TeamModel**ï¼šåªåšçŠ¶æ€æœº + äº‹ä»¶åº”ç”¨ï¼ˆapply eventï¼‰
* **TeamEventLog**ï¼šäº‹ä»¶åºå·ã€é‡æ”¾ã€å»é‡ï¼ˆåªå®šä¹‰ç»“æ„ï¼Œä¸åš IOï¼‰
* **Policy**ï¼šè¶…æ—¶é˜ˆå€¼ã€invite TTLã€presence å‘¨æœŸç­‰ï¼ˆUI/é…ç½®å±‚å¯æ”¹ï¼‰
* **Codec**ï¼šTeamEnvelope + payload çš„åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼ˆä¸ç¢° radioï¼‰

> Domain ç»ä¸ç›´æ¥â€œå‘åŒ…/å­˜ç›˜/å¼¹ UIâ€ã€‚

### Usecaseï¼ˆç¼–æ’ï¼‰

* æ¥æ”¶ UI action â†’ è°ƒ domain â†’ è°ƒ portsï¼ˆtransport/store/cryptoï¼‰
* æ¥æ”¶ radio packet â†’ decode â†’ éªŒè¯/è§£å¯† â†’ apply â†’ å¿…è¦æ—¶ sync/å›åŒ…
* è¾“å‡º UI éœ€è¦çš„æ´¾ç”Ÿæ•°æ®ï¼šteam healthã€member listã€security çŠ¶æ€

### Ports/Infra

* transportï¼šæŠŠ â€œTeamPacket bytesâ€ å‘åˆ° Meshtastic
* storeï¼ševentlog appendã€snapshot load/save
* cryptoï¼škey æ´¾ç”Ÿã€encrypt/decryptã€MAC æ ¡éªŒ
* clock/rngï¼šæä¾›å¯æµ‹æ›¿èº«ï¼ˆå•æµ‹ã€ä»¿çœŸï¼‰

### UI

* é¡µé¢åªå…³å¿ƒ **æ˜¾ç¤ºçŠ¶æ€** + **å‘ action**
* UI ä¸åš join/kick çš„ä¸šåŠ¡åˆ¤æ–­ï¼ˆæ¯”å¦‚ epoch rotate å¿…é¡»ç”± usecase åšï¼‰

---

# 2) é¢†åŸŸæ¨¡å‹ï¼ˆDomainï¼‰æœ€å°å®šä¹‰

## 2.1 Team çŠ¶æ€ï¼ˆåªåŒ…å« v0.1 å¿…éœ€ï¼‰

```cpp
enum class TeamRole : uint8_t { Leader, Member, None };

enum class TeamSecurityState : uint8_t {
  OK,        // epochåŒ¹é…ä¸”å¯è§£å¯†
  WARN,      // éœ€è¦syncæˆ–å‘ç°epochå·®å¼‚ä½†å°šèƒ½å·¥ä½œ
  FAIL       // è§£å¯†å¤±è´¥/è¢«è¸¢/å¯†é’¥ç¼ºå¤±
};

struct TeamId { std::array<uint8_t,16> bytes; };
struct MemberId { uint32_t node_id; };

struct MemberInfo {
  MemberId id;
  std::string name;        // å¯é€‰
  TeamRole role;           // Leader/Member
  uint32_t last_seen_ts;   // ç§’
  uint32_t caps;           // ä½æ ‡å¿—ï¼špos/wp/sync
};

struct TeamState {
  bool in_team = false;
  TeamId team_id;
  uint32_t epoch = 0;
  TeamRole self_role = TeamRole::None;
  MemberId leader_id;

  // å…³é”®ï¼šæˆå‘˜é›†åˆï¼ˆä»¥äº‹ä»¶é‡æ”¾å¾—åˆ°ï¼‰
  std::vector<MemberInfo> members;

  // äº‹ä»¶åºå·ï¼ˆç”¨äºsyncï¼‰
  uint32_t last_event_seq = 0;

  // å®‰å…¨æ€
  TeamSecurityState security = TeamSecurityState::FAIL;
};
```

## 2.2 å…³é”®äº‹ä»¶ï¼ˆå¯é‡æ”¾ï¼‰

```cpp
enum class TeamEventType : uint8_t {
  TeamCreated,
  MemberAccepted,
  MemberKicked,
  LeaderTransferred,
  EpochRotated,
  // v0.1 ä¸åšï¼šå¤æ‚æƒé™/å¯¹è±¡
};

struct TeamEvent {
  uint32_t event_seq;      // å•è°ƒé€’å¢ï¼ˆleaderä¸ºæƒå¨æºï¼‰
  uint32_t ts;
  TeamEventType type;
  // payload: member_id, new_leader, new_epoch ...
};
```

## 2.3 TeamModelï¼šå”¯ä¸€çš„â€œçœŸç›¸æ›´æ–°å…¥å£â€

```cpp
class TeamModel {
public:
  TeamState s;

  // apply must be pure: no IO
  void apply(const TeamEvent& e);

  // derived
  bool isLeader() const;
  bool isMember() const;
  const MemberInfo* findMember(MemberId id) const;
};
```

---

# 3) Usecase ç¼–æ’ï¼ˆæ ¸å¿ƒ service + flowsï¼‰

## 3.1 TeamServiceï¼ˆå”¯ä¸€å…¥å£ï¼‰

> ä½ å¯ä»¥åƒ ChatService ä¸€æ ·åšä¸€ä¸ª TeamServiceï¼šUI å’Œ MeshAdapter éƒ½åªè·Ÿå®ƒäº¤äº’ã€‚

```cpp
class TeamService {
public:
  TeamService(ITeamStore&, ITeamTransport&, ITeamCrypto&, IClock&, IRng&, IUiNotifier*);

  // UI actions
  void uiCreateTeam();
  void uiOpenInvite();
  void uiStopInvite();
  void uiJoinByCode(std::string code);
  void uiJoinNearby(TeamId team, std::string hint);
  void uiCancelJoin();
  void uiRetryJoin();
  void uiLeaveTeam();
  void uiKickMember(MemberId target);
  void uiTransferLeader(MemberId target);

  // Radio input
  void onTeamPacket(const uint8_t* data, size_t len, uint32_t from_node);

  // Tick (timers): presence broadcast, invite broadcast, stale detection, retry
  void tick1s();

  // UI data
  TeamState snapshot() const;
  TeamHealth computeHealth() const;

private:
  TeamModel model_;
  // ports
  ITeamStore& store_;
  ITeamTransport& transport_;
  ITeamCrypto& crypto_;
  IClock& clock_;
  IRng& rng_;
  IUiNotifier* ui_;

  // runtime: join flow state, invite state, pending requests etc.
  JoinRuntime join_;
  InviteRuntime invite_;
  SyncRuntime sync_;

  // helpers
  void persistSnapshotSoon();
  void appendEventAndApply(const TeamEvent& e);
  void broadcastPresenceIfDue();
  void broadcastInviteIfDue();
};
```

---

# 4) çŠ¶æ€æœºä¼ªä»£ç ï¼ˆUI ä¸åè®®éƒ½åœ¨è¿™é‡Œé—­ç¯ï¼‰

ä¸‹é¢ç»™ä¸¤å¥—çŠ¶æ€æœºï¼š

* **UI é¡µé¢çŠ¶æ€æœº**ï¼ˆä½  LVGL é¡µé¢çš„æµè½¬ï¼‰
* **åè®®/ä¸šåŠ¡çŠ¶æ€æœº**ï¼ˆjoin/kick/rotate/sync çš„çœŸå®é€»è¾‘ï¼‰

---

## 4.1 UI é¡µé¢çŠ¶æ€æœºï¼ˆTeam Screen Navigationï¼‰

### UI çŠ¶æ€

```cpp
enum class TeamPage {
  StatusNotInTeam,
  StatusInTeam,
  TeamHome,
  Invite,
  JoinSelect,
  JoinPending,
  Members,
  MemberDetail,
  KickConfirm,
  KickedOut
};

struct TeamUiState {
  TeamPage page;
  // selections
  int selected_member_index = -1;
  MemberId selected_member;
  // join temp
  std::string join_code;
  // flags
  bool busy = false;
  std::string toast;
};
```

### é¡µé¢æµè½¬ä¼ªä»£ç ï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰

```cpp
// called when entering Team menu
void TeamUI::enter() {
  auto s = teamService.snapshot();
  if (!s.in_team) navTo(StatusNotInTeam);
  else navTo(StatusInTeam);
}

// StatusNotInTeam
onClick(CreateTeam) { teamService.uiCreateTeam(); ui.busy=true; }
onClick(JoinTeam)   { navTo(JoinSelect); }

// StatusInTeam
onClick(ViewTeam)   { navTo(TeamHome); }
onClick(Invite)     { if (isLeader) navTo(Invite); else toast("Only leader"); }
onClick(Leave)      { teamService.uiLeaveTeam(); navTo(StatusNotInTeam); }

// TeamHome
onClick(Invite)     { ... }
onClick(Manage)     { if (isLeader) navTo(Members); }
onClick(Leave)      { ... }

// JoinSelect
onSelect(NearbyTeam) { teamService.uiJoinNearby(team_id, hint); navTo(JoinPending); }
onClick(EnterCode)   { navTo(JoinSelectInputCode); } // å¯ç”¨åŒé¡µè¾“å…¥
onClick(JoinByCode)  { teamService.uiJoinByCode(code); navTo(JoinPending); }

// JoinPending
onClick(Cancel) { teamService.uiCancelJoin(); navTo(JoinSelect); }
onClick(Retry)  { teamService.uiRetryJoin(); }

// Members
onSelect(Member) { ui.selected_member=...; navTo(MemberDetail); }

// MemberDetail
onClick(Kick) { navTo(KickConfirm); }
onClick(TransferLeader) { teamService.uiTransferLeader(ui.selected_member); navTo(TeamHome); }

// KickConfirm
onClick(ConfirmKick) { teamService.uiKickMember(ui.selected_member); navTo(StatusInTeam); }

// KickedOut
onClick(JoinAnother) { navTo(JoinSelect); }
onClick(OK) { navTo(StatusNotInTeam); }
```

### UI ä¸ service çš„ç»‘å®š

UI ä¸ç›´æ¥åˆ¤æ–­â€œå®‰å…¨è½®æ¬¡å¦‚ä½•æ›´æ–°â€ï¼Œå®ƒåªè§¦å‘ï¼š

* `uiKickMember(target)`
* `uiJoinByCode(code)`
  ç”± service åšåè®®ä¸çŠ¶æ€æ›´æ–°ï¼ŒUIåªè®¢é˜… `snapshot()` å˜åŒ–ã€‚

---

## 4.2 åè®®/ä¸šåŠ¡çŠ¶æ€æœºï¼ˆJoin/Kick/Rotate/Syncï¼‰

### 4.2.1 Join Flow Runtime

```cpp
enum class JoinPhase {
  Idle,
  Discovering,      // å¯é€‰ï¼šæ‰«æé™„è¿‘ invite
  Requested,        // å·²å‘ JOIN_REQ
  WaitingDecision,  // ç­‰ ACCEPT/REJECT
  WaitingKey,       // ç­‰ KEY_DIST
  Joined,           // æˆåŠŸ
  Failed
};

struct JoinRuntime {
  JoinPhase phase = JoinPhase::Idle;
  TeamId target_team;
  uint32_t started_ts = 0;
  uint8_t retries = 0;
  std::string invite_code;
};
```

### 4.2.2 Invite Flow Runtimeï¼ˆLeaderï¼‰

```cpp
struct InviteRuntime {
  bool active = false;
  std::string invite_code;
  uint32_t expire_ts = 0;
  uint32_t last_broadcast_ts = 0;
};
```

### 4.2.3 æ ¸å¿ƒä¼ªä»£ç ï¼šUI Create Team

```cpp
void TeamService::uiCreateTeam() {
  // 1) domain init
  model_.s.in_team = true;
  model_.s.team_id = rng_.randomTeamId();
  model_.s.epoch = 1;
  model_.s.self_role = TeamRole::Leader;
  model_.s.leader_id = selfNodeId();

  // 2) crypto init
  crypto_.setTeamKey(model_.s.team_id, model_.s.epoch, crypto_.randomKey());

  // 3) persist snapshot (store)
  store_.saveSnapshot(model_.s);
  // 4) optional: append TeamCreated event (event_seq=1)
  appendEventAndApply(makeTeamCreatedEvent());
}
```

---

## 4.2.4 Leaderï¼šInvite å¹¿æ’­

```cpp
void TeamService::uiOpenInvite() {
  if (!model_.isLeader()) return;
  invite_.active = true;
  invite_.invite_code = makeShortCode(rng_);
  invite_.expire_ts = clock_.now() + policy.invite_ttl_s;
  invite_.last_broadcast_ts = 0;
}

void TeamService::broadcastInviteIfDue() {
  if (!invite_.active) return;
  if (clock_.now() > invite_.expire_ts) { invite_.active=false; return; }
  if (clock_.now() - invite_.last_broadcast_ts < policy.invite_broadcast_period_s) return;

  auto pkt = encodeInvite(model_.s.team_id, model_.s.epoch, invite_.invite_code, invite_.expire_ts);
  transport_.send(pkt);
  invite_.last_broadcast_ts = clock_.now();
}
```

---

## 4.2.5 Memberï¼šJoin è¯·æ±‚

```cpp
void TeamService::uiJoinByCode(std::string code) {
  join_.phase = JoinPhase::Requested;
  join_.invite_code = code;
  join_.started_ts = clock_.now();
  join_.retries = 0;

  // ç›®æ ‡ team_id å¯èƒ½æœªçŸ¥ï¼šä¸¤ç§åšæ³•
  // A) codeæœ¬èº«ç¼–ç teamçŸ­ç  -> å¯ç›´æ¥å¾—åˆ° team_id_hint
  // B) å…ˆç­‰å¾…é™„è¿‘ invite åŒ¹é… code -> å¾—åˆ° team_id
  // v0.1 æ¨èï¼šcode + nearby invite åŒ¹é…åå†å‘è¯·æ±‚

  sendJoinReq();
}

void TeamService::sendJoinReq() {
  auto req = encodeJoinReq(/*team_id*/ join_.target_team,
                          /*code*/ join_.invite_code,
                          /*self*/ selfNodeId(),
                          /*nonce*/ rng_.u32());
  transport_.send(req);
  join_.phase = JoinPhase::WaitingDecision;
}
```

---

## 4.2.6 Leaderï¼šå¤„ç† JOIN_REQï¼ˆå¼¹çª— + Accept/Rejectï¼‰

```cpp
void TeamService::onJoinReq(const JoinReq& req, uint32_t from) {
  if (!model_.isLeader()) return;
  if (!invite_.active) return;
  if (clock_.now() > invite_.expire_ts) return;
  if (req.code != invite_.invite_code) return; // v0.1ï¼šç®€å•åŒ¹é…

  // è®© UI å¼¹çª—ï¼šAccept / Reject
  ui_->promptJoinRequest(from, /*name*/ req.name);
  // Accept çš„åŠ¨ä½œèµ° uiAcceptJoin(from)
}

void TeamService::uiAcceptJoin(MemberId newcomer) {
  // 1) append event: MemberAccepted (event_seq++)
  appendEventAndApply(makeMemberAcceptedEvent(newcomer));

  // 2) epoch rotate (æˆå‘˜é›†åˆå˜åŒ–)
  rotateEpoch(); // epoch++

  // 3) send decision (å¸¦ new_epoch)
  transport_.send(encodeJoinDecisionAccept(model_.s.team_id, model_.s.epoch, newcomer));

  // 4) distribute keys to all current members
  distributeEpochKeyToMembers();
}
```

---

## 4.2.7 Epoch Rotate & Key Distï¼ˆv0.1 å…³é”®ï¼‰

```cpp
void TeamService::rotateEpoch() {
  // append event: EpochRotated(new_epoch)
  uint32_t new_epoch = model_.s.epoch + 1;
  appendEventAndApply(makeEpochRotatedEvent(new_epoch));

  // generate key for new epoch
  auto new_key = crypto_.randomKey();
  crypto_.setTeamKey(model_.s.team_id, new_epoch, new_key);
}

void TeamService::distributeEpochKeyToMembers() {
  for (auto& m : model_.s.members) {
    if (m.id == kicked_target) continue;
    // v0.1: ç”¨ç‚¹å¯¹ç‚¹å°è£…ï¼ˆå¯ä»¥ç”¨ Meshtastic channel PSK æˆ–ä½ çš„è®¾å¤‡é¢„å…±äº«æ–¹å¼ï¼‰
    auto pkt = encodeKeyDist(model_.s.team_id, model_.s.epoch, m.id, crypto_.getTeamKey(...));
    transport_.sendTo(m.id, pkt); // å¦‚æœ transport æ”¯æŒå®šå‘ï¼Œå¦åˆ™å¹¿æ’­ + ç›®æ ‡å­—æ®µ
  }
}
```

---

## 4.2.8 Memberï¼šæ”¶åˆ° ACCEPT + KEY_DIST

```cpp
void TeamService::onJoinDecision(const JoinDecision& d) {
  if (join_.phase != JoinPhase::WaitingDecision) return;
  if (!d.accept) { join_.phase = JoinPhase::Failed; ui_->toast("Rejected"); return; }

  // è®°å½•ç›®æ ‡ epochï¼Œç­‰å¾… key
  join_.phase = JoinPhase::WaitingKey;
  join_.expected_epoch = d.new_epoch;
}

void TeamService::onKeyDist(const KeyDist& kd) {
  if (join_.phase != JoinPhase::WaitingKey) return;
  if (kd.epoch != join_.expected_epoch) return;

  crypto_.setTeamKey(kd.team_id, kd.epoch, kd.key);
  // æˆåŠŸåŠ å…¥ï¼šæ›´æ–°æœ¬åœ°team snapshotï¼ˆå¯ä»¥ä» decision æºå¸¦çš„ leader_id/æˆå‘˜æ‘˜è¦æ¢å¤ï¼‰
  model_.s.in_team = true;
  model_.s.team_id = kd.team_id;
  model_.s.epoch = kd.epoch;
  model_.s.self_role = TeamRole::Member;
  model_.s.security = TeamSecurityState::OK;

  store_.saveSnapshot(model_.s);
  join_.phase = JoinPhase::Joined;
}
```

---

## 4.2.9 Kick Flowï¼ˆLeader â†’ å…¨é˜Ÿï¼‰

```cpp
void TeamService::uiKickMember(MemberId target) {
  if (!model_.isLeader()) return;

  // 1) event: MemberKicked(target)
  appendEventAndApply(makeMemberKickedEvent(target));

  // 2) epoch rotate
  rotateEpoch();

  // 3) broadcast kick + epoch rotate markerï¼ˆå¯åˆå¹¶æˆä¸€ä¸ª control åŒ…ï¼‰
  transport_.send(encodeKick(model_.s.team_id, model_.s.epoch, target));

  // 4) distribute new key to remaining members
  distributeEpochKeyToMembers();
}
```

### è¢«è¸¢æˆå‘˜çš„å¤„ç†ï¼ˆMember ä¾§ï¼‰

```cpp
void TeamService::onKick(const Kick& k) {
  if (!model_.s.in_team) return;
  if (k.target != selfNodeId()) {
    // å…¶ä»–äººè¢«è¸¢ï¼šapplyäº‹ä»¶ã€ç­‰å¾…keyæ›´æ–°
    appendEventAndApply(makeMemberKickedEvent(k.target));
    model_.s.security = TeamSecurityState::WARN;
    return;
  }

  // è‡ªå·±è¢«è¸¢ï¼šç«‹å³å¤±æ•ˆ
  model_.s.in_team = false;
  model_.s.security = TeamSecurityState::FAIL;
  crypto_.wipeTeamKeys(model_.s.team_id);
  store_.clearTeam(); // æˆ–æ ‡è®° revoked
  ui_->navToKickedOut();
}
```

---

## 4.2.10 Presence & Healthï¼ˆçŠ¶æ€é¡µæ•°æ®æ¥æºï¼‰

```cpp
void TeamService::broadcastPresenceIfDue() {
  if (!model_.s.in_team) return;
  if (clock_.now() - last_presence_ts < policy.presence_period_s) return;

  auto pkt = encodePresence(model_.s.team_id, model_.s.epoch,
                           selfNodeId(),
                           /*event_seq*/ model_.s.last_event_seq,
                           /*battery*/ readBattery(),
                           /*fix*/ gpsFix());
  transport_.send(pkt);
  last_presence_ts = clock_.now();
}

void TeamService::onPresence(const Presence& p) {
  if (!acceptTeam(p.team_id)) return;

  // epoch mismatch: warn + possible sync
  if (p.epoch != model_.s.epoch) {
    model_.s.security = TeamSecurityState::WARN;
    maybeSync(p);
  }

  updateMemberLastSeen(p.sender, p.ts);
  if (p.event_seq > model_.s.last_event_seq) {
    requestSyncFrom(p.sender, model_.s.last_event_seq + 1);
  }
}
```

---

## 4.2.11 Syncï¼ˆè¡¥é½å…³é”®äº‹ä»¶ï¼‰

```cpp
void TeamService::requestSyncFrom(MemberId peer, uint32_t from_seq) {
  auto req = encodeSyncReq(model_.s.team_id, model_.s.epoch, from_seq);
  transport_.sendTo(peer, req);
}

void TeamService::onSyncReq(const SyncReq& r, MemberId from) {
  // ä» store æ‹‰æœ€è¿‘Næ¡ event å›åŒ…
  auto events = store_.readEventsFrom(r.from_seq, policy.sync_max_events);
  transport_.sendTo(from, encodeSyncRsp(model_.s.team_id, model_.s.epoch, events));
}

void TeamService::onSyncRsp(const SyncRsp& rsp) {
  for (auto& e : rsp.events) {
    if (e.event_seq <= model_.s.last_event_seq) continue;
    model_.apply(e);
    store_.appendEvent(e);
  }
  store_.saveSnapshot(model_.s);
  model_.s.security = TeamSecurityState::OK;
}
```

---

# 5) UI ä¸åè®®â€œå¯¹é½ç‚¹æ¸…å•â€ï¼ˆä½ è½åœ°æ—¶æœ€æœ‰ç”¨ï¼‰

## 5.1 æ¯ä¸ªé¡µé¢è§¦å‘çš„ usecase

* StatusNotInTeamï¼šCreate â†’ `uiCreateTeam()`ï¼›Join â†’ `uiJoin...()`
* JoinSelectï¼šé€‰æ‹©é™„è¿‘é˜Ÿä¼ â†’ `uiJoinNearby()`ï¼›è¾“å…¥ code â†’ `uiJoinByCode()`
* JoinPendingï¼šRetry/Cancel â†’ `uiRetryJoin()/uiCancelJoin()`
* Inviteï¼šRefresh/Stop â†’ `uiOpenInvite()/uiStopInvite()`
* Members/Detail/KickConfirmï¼šKick/Transfer â†’ `uiKickMember()/uiTransferLeader()`
* KickedOutï¼šJoin Another â†’ å› JoinSelect

## 5.2 é¡µé¢å­—æ®µæ¥è‡ªå“ªé‡Œ

* Members/Onlineï¼š`TeamService.snapshot()`
* Security OK/WARN/FAILï¼šæ¥è‡ª

  * è§£å¯†æˆåŠŸä¸å¦ï¼ˆcryptoï¼‰
  * epoch æ˜¯å¦ä¸€è‡´ï¼ˆpresence/æ§åˆ¶åŒ…ï¼‰
  * sync æ˜¯å¦å®Œæˆ
* Last updateï¼šæ¥è‡ª

  * æœ€è¿‘ä¸€æ¬¡ presence/æ§åˆ¶äº‹ä»¶å¤„ç†æ—¶é—´

---

# 6) ä½ å¯ä»¥ç›´æ¥ç…§è¿™ä¸ªå¼€å·¥çš„â€œç¬¬ä¸€æ‰¹æ–‡ä»¶â€

å¦‚æœä½ æƒ³æœ€å¿«æŠŠéª¨æ¶è·‘èµ·æ¥ï¼Œæˆ‘å»ºè®®æŒ‰è¿™ä¸ªé¡ºåºå»ºæ–‡ä»¶ï¼š

1. `domain/team_types.h` + `domain/team_events.h`
2. `domain/team_model.cpp`ï¼ˆapply äº‹ä»¶ï¼‰
3. `ports/i_team_transport.h`ï¼ˆsend / sendTo / onPacketï¼‰
4. `usecase/team_service.cpp`ï¼ˆå…ˆåªåš create + invite å¹¿æ’­ + presenceï¼‰
5. `ui/screens/team/team_state.h` + `team_pages.cpp`ï¼ˆStatusNotInTeam / StatusInTeam ä¸¤é¡µå…ˆè·‘èµ·æ¥ï¼‰
6. å†åŠ  join/kick/sync